Scripts and configuration files for running Geant4 validation on Azure batch
resources using batch-shipyard.

Install batch-shipyard and use the provided json configuration files:

#### Credentials
Copy the `credentials-template.json` file and add the credentials from
azure accunts and docker registries.

#### General configuraions and pools
`global.conf` and `pool.json` configure general aspecs and the pool to be
used.

### Jobs configuration
The file `jobs-example.json` is a standalone example with a single task using the 
`andreadotti/geant4-val:latest` docker image that should contain the
`ProcessTest` application.

Under the directory `ProcessTest` real configuration files can be found.  
Since the corresponding jobs json configuration file is quite long and 
tedious to write, scripts to genrate them are provided. Refer to the 
instructions contained in that directory.

## Start tasks
 1. Add pool: `shipyard pool add --credentials credentials.json --config global.json --pool pool.json`
 2. Generate jobs file if needed: `cd ProcessTest && python gen-jobs-crosssections.py crosssections-list.json`
 3. Add jobs: `shipyard jobs add --credentials credentials.json --config global.json --pool pool.json --jobs ProcessTest/gen-jobs.json`

## Stop tasks
To remove tasks meta-data: `shipyard jobs del --credentials credentials.json --config global.json --pool pool.json --jobs jobs-example.json`
To remove pool: `shipyard pool del --credentials credentials.json --config global.json --pool pool.json --jobs jobs-example.json`

# Using `az-batch` interface
High level interface to batch-shipyard.

### Prerequisite
`batch-shipyard`
`jq`
### High level configuration file: `summary.json`
This file is a simple json file containing high level information about job 
definition and job configuration.  
The file contains the following information: 

 * `add_pool` true or false, if true add the pool when submitting jobs.  
 * `configurations` contains the name of shipyard configuration files. 
   Iff `jobs_file` is `null` the jobs json file for shipyard will be 
   auto-generated by one of the recipes.
 * `recipes` named commands to generate jobs json file

Recipes is a string of shell commands to generate jobs json file. The auto-generated file
should be called `.gen-jobs.json`.

### Usage
Type `az-batch -h` for instructions.

